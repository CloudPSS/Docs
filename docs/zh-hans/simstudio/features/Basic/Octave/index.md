---
title: 自定义控制元件
order: 110
author: jiajun
---

::: info
**在一些场合，使用已有的控制元件实现复杂的控制逻辑较为困难，而使用代码实现则相对简单。
CloudPSS SimStudio支持创建自定义控制元件，通过Matlab/Octave语言，可方便地实现复杂的控制逻辑。**
:::

本例以一个可调斜率和分段点的分段函数，向用户展示自定义控制元件的创建和使用方法。

## 新建自定义控制元件  

在CloudPSS SimStudio工作台，点击左上角的`新建`，在弹出的窗口中，选择项目模板下的**空白Octave元件**。点击窗口右下角的新建按钮，即可完成新建。

![新建自定义控制元件](./1.png "新建自定义控制元件")

## 参数与引脚定义

元件的参数与引脚类型可参考[参数及引脚体系](../ParameterSystem.md)帮助文档，参数与引脚的添加和设置方法可参考[模块封装](../Mask.md)帮助文档。    
  

本例中需要用到的可设置参数有第一段函数斜率*k1*、第二段函数斜率*k2*、分段点横坐标*a*和分段点纵坐标*b*。 在`接口`标签页的参数列表定义中作如下设置。  

![新建参数组并新建参数k1](./3.png "新建参数k1")

![新建参数k2](./4.png "新建参数k2")

![新建参数a](./5.png "新建参数a")

![新建参数b](./6.png "新建参数b")

本例中需要用到的引脚有一个输入引脚和一个输出引脚。在`接口`标签页的引脚列表定义中作如下设置。

![新建输入、输出引脚](./7.png "新建输入、输出引脚")

## 元件图形设计

在元件图形设计窗口绘制元件图标，并添加两个引脚，分别与input和output绑定。

![绘制元件图形并绑定引脚](./8.png "绘制元件图形并绑定引脚")

## 编辑代码

切换到`实现`标签页，选择`电磁暂态`标签，跳转到电磁暂态元件代码编辑窗口。此时，由于已经定义好元件的参数和引脚，它们的键名会自动识别并列出。

![编辑电磁暂态自定义控制元件](./9.png "编辑电磁暂态自定义控制元件")

同时，CloudPSS SimStudio已提供了三个内置变量，分别是*init*（当前是否为第一个时步）、*time*（仿真进行时间）和*deltaT*（仿真步长），用户可以直接使用这三个变量参与控制逻辑实现。

将可调斜率和分段点的分段函数代码填入代码编辑窗口。

![分段函数的代码实现](./10.png "分段函数的代码实现")

:::tip
**注意变量名称为`args.键名`的形式。**
:::

## 元件名称与权限设置

切换到`总览`标签页，输入元件的名称，并设置元件的`权限`和`元件标签`。权限设置为`私有`时，该元件仅用户自己可见；设置为`公开`时，该元件会出现在仿真广场中，所有用户可见。`元件标签`为该模块在模型库中的分组。

![元件名称与权限设置](./11.png "元件名称与权限设置")


## 元件描述与说明

`描述`中填写对元件的简要描述，可以使用MarkDown输入。

`文档`是对该元件的说明，在`接口`标签页将参数列表和引脚列表定义好后，文档会自动生成相关参数列表和端口列表的描述，显示参数和端口的信息。文档同样支持MarkDown输入，页面右侧会实时渲染编写的效果。

MarkDown语法的介绍详见[MarkDown语法介绍](../../Other/Markdown/index.md)功能帮助。

![元件描述与说明](./12.png "元件描述与说明")

## 效果展示

至此，一个可调斜率和分段点的分段函数元件便使用Octave语言构建好了。可以新建一个`普通项目`，在对应的`元件标签`中找到该元件，并验证仿真结果。

![自定义控制元件结果验证](./13.png "自定义控制元件结果验证")

![自定义控制元件效果展示](./output.png "自定义控制元件效果展示")