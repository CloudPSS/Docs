---

title: 仿真项目架构

author: pcp

category: 100

order: 101

---


## 基本概念
===============


### 解决方案（solution）
-----------------------------

CloudPSS仿真的基本组织方式，一个解决方案是多个项目的集合，这多个项目没
有直接的相关性，仅用于分组。


### 项目（project）
------------------------

项目是仿真计算的最小单位，存储了仿真项目的拓扑和参数。一个系统属于某一
个应用类型。


#### 元件/子系统

组成项目的构件。每一个元件/子系统也是一个独立的项目，在由其他项目引用
时被称为元件或子系统。在项目中，记录了每一个元件的项目版本rid或项目rid
，还保存了每个元件的参数和连接关系。


#### 图纸/图层


对系统中元件进行组织，一个系统可以包含多个图纸，每张图纸包含多个图层。


#### 参数集（parameter set）


一个项目作为子系统使用时，其全局参数是由使用它的项目提供的。为了保持一
致性，在独立使用一个项目作为主系统时，其全局参数仍旧不由系统内部提供，
而是通过每个项目随附的参数集提供。

一个参数集与其关联的项目绑定，其中的参数与对应项目的全局变量声明相对应
，可以提供该项目作为主系统独立仿真计算的参数。

一个项目中可以保存多个参数集，以便在多种用途下切换。


#### 方案（case）


记录了项目作为主系统启动应用的参数。

包括要启动的应用RID，应用的启动参数。

一个项目可以保存多个方案。可以由参数集与方案构成计算矩阵，完成多种情况
下的计算。


### 项目类型（project type）
---------------------------------

对项目预定义的类型，项目类型决定了在项目中能够使用的元件、子系统、全局
参数等。一种应用（如电磁暂态、潮流）只能服务于特定的项目类型。


### 应用（application）
----------------------------

对计算任务类型的定义，包含其名称、能够处理的应用类型、启动的任务定义（
job definition）名称、参数等信息。


### 计算任务（job）
------------------------

使用调度中台管理的任务，是启动计算任务生成的任务实例。


### 项目/子系统及其管理
----------------------------


### 项目
-------------

项目有自己的RID。

参照上文的描述。一个项目中实际只包含了参数集、方案相关信息和一些简单的
元数据，以及系统最新版本（project revision）的hash。系统的实际参数和拓
扑信息由下述的版本系统进行管理。


### 项目版本（project revision）
-------------------------------------

每次对项目进行编辑保存，就会形成一个项目版本（以下称作“版本”）。一个版
本即为一个项目包含完整拓扑和参数的快照（但参数集、方案的值不包含在内）
。记录每个版本文件的特征值（hash），作为版本的主索引。每个版本**一经创
建，不可更改**。

一个版本记录的信息主要包含：

* hash：版本实际内容的特征值，也是数据库的主索引

* parent：该版本的父版本hash，可空

* data：系统的参数和拓扑等信息，包含一个防止哈希碰撞的nonce。nonce可以
  由用户指定，此时应对nonce长度加以要求，防止碰撞产生。

* created：版本的创建时间

版本系统不包含权限管理相关的功能。hash应当足够复杂，避免碰撞的产生。所
有可以提供正确hash的用户即被认为拥有了相应版本的访问权限。

注意：这意味着一旦用户将某一个版本发布/共享给他人，该版本的权限将永远
无法收回。即使后续删除了分享的权限，也仅限于后续发布的新版本无法被继续
使用。事实上，被分享的用户甚至可以将该版本重新保存为自己的命名版本，并
进行二次分发 。就算是版本管理这里进行了限制，用户也完全可以通过hash下
载对应的系统文件，并重新上传，该行为实质上无法控制。


#### 快照版本（snapshot revision）

基于用户保存的版本。每个版本记录其父版本的key。实现历史记录查询、历史
版本恢复等功能。


#### 命名版本（named revision）


给某个版本指定了名称和描述后，就形成了一个命名版本。命名版本有自己的
RID。

一个由项目的历史版本命名产生的命名版本会保存与其相关联项目的关系，并显
示在项目的相关页面下。

命名版本也可以不存在对应的项目RID，如用户直接上传的分离版本、用户删除
项目后保留的命名版本均属于此类情况。

通过项目或命名版本的RID，其他项目可以将该项目/版本作为自己的子系统使用
。


#### 最新版本（latest revision）


通过项目保存的最新版本hash，可以在版本库中找到一个项目的最新版本。一个
项目的编辑历史由此版本出发，沿父版本向上搜寻直至某一版本不存在父版本。

其他项目可以通过项目RID引用一个项目的最新版本。


#### 分离版本（detached revision）


满足以下条件的版本：

1. 这不是是一个命名版本，或

2. 这不是一个最新版本或其直接或间接父级版本（即不属于任何项目的历史记
   录）

被称为分离版本。一般由于用户主动上传或删除了对应的系统/命名版本产生。

用户也可以在将项目保存为命名版本时主动选择生成分离版本，此时后台会将对
应版本选取不同的nonce后保存，以便生成新的hash。


#### 关于CLOUDPSS官方元件

CloudPSS官方元件也以子系统的方式发布，每一个元件有自己的项目RID。但一
般不会发布命名版本，即强制所有用户使用CloudPSS的最新版本元件。尽管格式
与用户创建的项目一致，这些RID实质只是一个标签，在版本库中并不存在对应
的版本数据。


#### 版本的删除


用户无法主动对版本进行删除操作。通过一个定时运行的垃圾回收程序，生成时
间距今大于一个指定阈值的分离版本将会被自动删除。

计算任务发布流程


### 确定需要计算的版本
----------------------------

要发布一个计算任务，首先需要获取其版本key。

对于用户手动上传的分离版本，API直接将版本保存进数据库，并返回对应的
hash。用户可以直接使用此hash开始计算任务。也可以通过此hash建立一个命名
版本，以供后续使用。甚至可以将一个hash导入为新的项目，进行后续开发。

对于一个项目或命名版本，可以通过API获取其对应的hash。这两者都是拥有自
己RID的资源，自然权限校验也在该步骤完成。


### 启动任务
------------------

向调度中台发布任务。任务定义为需要进行的计算任务定义。任务参数为版本
key、参数组、以及该计算任务所需的其他参数，如结果保存用的数据中台RID。

通过生成的任务RID，可以对任务的运行状况进行监测和管理。


### 获取结果
------------------

通过数据中台获取计算结果。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~